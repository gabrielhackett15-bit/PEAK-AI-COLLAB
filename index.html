<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity Arena v1.3 // Parallel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: ui-sans-serif, system-ui; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        .output-card { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen flex flex-col items-center">
    <div class="w-full max-w-4xl">
        <header class="mb-8 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-black text-blue-500 tracking-tighter italic">TRINITY ARENA</h1>
                <p class="text-[10px] font-mono text-slate-500 uppercase tracking-[0.4em]">v1.3 Parallel Neural Routing</p>
            </div>
            <button onclick="toggleSettings()" class="text-xs bg-slate-800 px-4 py-2 rounded-full border border-slate-700">‚öôÔ∏è CONFIG</button>
        </header>

        <div id="settings" class="hidden glass p-6 rounded-3xl mb-6 border-blue-500/30">
            <input id="workerUrl" type="text" placeholder="https://your-worker.workers.dev" class="w-full p-3 rounded-xl bg-slate-900 border border-slate-800 text-sm mb-4">
            <input id="workerKey" type="password" placeholder="NVIDIA NIM API Key" class="w-full p-3 rounded-xl bg-slate-900 border border-slate-800 text-sm">
        </div>

        <div class="glass p-6 rounded-3xl mb-6 border-white/5">
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-2">
                    <button onclick="setMode('help')" id="mode-help" class="text-[10px] font-black px-4 py-2 rounded-full transition-all">CONSENSUS</button>
                    <button onclick="setMode('debate')" id="mode-debate" class="text-[10px] font-black px-4 py-2 rounded-full transition-all">DEBATE</button>
                </div>
                <button onclick="syncModels()" id="syncBtn" class="text-[10px] bg-blue-600 px-4 py-2 rounded-full font-black uppercase">üîÑ Sync Registry</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <select id="model1" class="w-full bg-slate-800 p-4 rounded-2xl border border-slate-700 text-xs font-bold"></select>
                <select id="model2" class="w-full bg-slate-800 p-4 rounded-2xl border border-slate-700 text-xs font-bold"></select>
            </div>
        </div>

        <div class="glass p-4 rounded-3xl mb-8 glow-blue">
            <textarea id="userInput" placeholder="Submit prompt..." class="w-full h-24 bg-transparent p-2 text-lg outline-none resize-none"></textarea>
            <button onclick="initiateSequence()" id="execBtn" class="w-full mt-4 bg-blue-600 py-4 rounded-2xl font-black text-xl">INITIATE SEQUENCE</button>
        </div>

        <div id="output" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20"></div>
    </div>

    <script>
        let currentMode = 'help';
        document.getElementById('workerUrl').value = localStorage.getItem('t_url') || '';
        document.getElementById('workerKey').value = localStorage.getItem('t_key') || '';
        setMode('help');

        function toggleSettings() { document.getElementById('settings').classList.toggle('hidden'); }
        function setMode(m) {
            currentMode = m;
            const h = document.getElementById('mode-help'); const d = document.getElementById('mode-debate');
            h.className = m === 'help' ? "text-[10px] font-black px-4 py-2 rounded-full bg-blue-600" : "text-[10px] font-black px-4 py-2 rounded-full bg-slate-800 text-slate-500";
            d.className = m === 'debate' ? "text-[10px] font-black px-4 py-2 rounded-full bg-red-600" : "text-[10px] font-black px-4 py-2 rounded-full bg-slate-800 text-slate-500";
        }

        async function syncModels() {
            const url = document.getElementById('workerUrl').value.replace(/\/$/, "") + "/v1/models";
            try {
                const res = await fetch(url, { headers: { "Authorization": `Bearer ${document.getElementById('workerKey').value}` } });
                const json = await res.json();
                [document.getElementById('model1'), document.getElementById('model2')].forEach(s => {
                    s.innerHTML = "";
                    json.data.forEach(m => s.add(new Option(m.id, m.id)));
                });
            } catch (e) { alert("CORS Error. Ensure 'CORS Unblock' is ON."); }
        }

        function createCard(id, model, label, color) {
            const div = document.createElement('div');
            div.id = id;
            div.className = `output-card glass p-6 rounded-3xl border-l-4 ${color}`;
            div.innerHTML = `<div class="text-[9px] font-black opacity-40 mb-2 uppercase">${label} // ${model}</div><div class="content text-sm leading-relaxed animate-pulse">THINKING...</div>`;
            document.getElementById('output').appendChild(div);
            return div;
        }

        async function apiCall(model, prompt, sys) {
            const url = document.getElementById('workerUrl').value.replace(/\/$/, "") + "/v1/chat/completions";
            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${document.getElementById('workerKey').value}` },
                body: JSON.stringify({ model, messages: [{role: "system", content: sys}, {role: "user", content: prompt}] })
            });
            const data = await res.json();
            return data.choices[0].message.content;
        }

        async function initiateSequence() {
            const prompt = document.getElementById('userInput').value;
            const m1 = document.getElementById('model1').value;
            const m2 = document.getElementById('model2').value;
            if(!prompt) return;

            localStorage.setItem('t_url', document.getElementById('workerUrl').value);
            localStorage.setItem('t_key', document.getElementById('workerKey').value);
            document.getElementById('output').innerHTML = "";

            // Create placeholder cards immediately
            const card1 = createCard("c1", m1, currentMode === 'help' ? "Architect" : "PRO", "border-blue-500");
            const card2 = createCard("c2", m2, currentMode === 'help' ? "Auditor" : "CON", "border-red-500");

            // PARALLEL CALLS: Both models fire at once
            const calls = [
                apiCall(m1, prompt, currentMode === 'help' ? "Be constructive." : "Argue FOR."),
                apiCall(m2, prompt, currentMode === 'help' ? "Be critical." : "Argue AGAINST.")
            ];

            const [r1, r2] = await Promise.all(calls);
            card1.querySelector('.content').classList.remove('animate-pulse');
            card1.querySelector('.content').innerText = r1;
            card2.querySelector('.content').classList.remove('animate-pulse');
            card2.querySelector('.content').innerText = r2;
        }
    </script>
</body>
</html>
