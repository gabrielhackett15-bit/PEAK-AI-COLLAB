<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity Arena v1.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: ui-sans-serif, system-ui; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        .output-card { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen flex flex-col items-center">
    <div class="w-full max-w-3xl">
        <header class="mb-10 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-black text-blue-500 tracking-tighter italic">TRINITY ARENA</h1>
                <p class="text-[10px] font-mono text-slate-500 uppercase tracking-[0.4em]">Neural Proxy // Mobile-Optimized</p>
            </div>
            <button onclick="toggleSettings()" class="text-xs bg-slate-800 px-4 py-2 rounded-full border border-slate-700 hover:bg-slate-700 transition">‚öôÔ∏è CONFIG</button>
        </header>

        <div id="settings" class="hidden glass p-6 rounded-3xl mb-6 border-blue-500/30 glow-blue">
            <h2 class="text-sm font-bold mb-4 text-blue-400">ENDPOINT CONFIGURATION</h2>
            <div class="space-y-4">
                <input id="workerUrl" type="text" placeholder="https://your-worker.workers.dev" class="w-full p-3 rounded-xl bg-slate-900 border border-slate-800 text-sm outline-none focus:border-blue-500">
                <input id="workerKey" type="password" placeholder="NVIDIA NIM / Worker Key" class="w-full p-3 rounded-xl bg-slate-900 border border-slate-800 text-sm outline-none focus:border-blue-500">
            </div>
        </div>

        <div class="glass p-6 rounded-3xl mb-6 border-white/5">
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-4">
                    <button onclick="setMode('help')" id="mode-help" class="text-xs font-black px-4 py-2 rounded-full transition-all">ü§ù CONSENSUS</button>
                    <button onclick="setMode('debate')" id="mode-debate" class="text-xs font-black px-4 py-2 rounded-full transition-all">‚öîÔ∏è DEBATE</button>
                </div>
                <button onclick="syncModels()" id="syncBtn" class="text-[10px] bg-blue-600 px-3 py-1 rounded-full font-bold uppercase hover:bg-blue-400 transition">üîÑ Sync Registry</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold opacity-40 ml-2">PRIMARY NODE</label>
                    <select id="model1" class="w-full bg-slate-800 p-4 rounded-2xl border border-slate-700 text-sm font-bold outline-none cursor-pointer"></select>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold opacity-40 ml-2">SECONDARY NODE</label>
                    <select id="model2" class="w-full bg-slate-800 p-4 rounded-2xl border border-slate-700 text-sm font-bold outline-none cursor-pointer"></select>
                </div>
            </div>
        </div>

        <div class="glass p-4 rounded-3xl mb-8 border-white/10 glow-blue">
            <textarea id="userInput" placeholder="Awaiting neural instructions..." class="w-full h-32 bg-transparent p-2 text-lg outline-none resize-none placeholder:opacity-20"></textarea>
            <button onclick="initiateSequence()" id="execBtn" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-xl tracking-widest shadow-xl shadow-blue-900/20 active:scale-[0.98] transition-all">INITIATE SEQUENCE</button>
        </div>

        <div id="output" class="space-y-6 pb-20"></div>
    </div>

    <script>
        let currentMode = 'help';
        
        // Load persistency
        document.getElementById('workerUrl').value = localStorage.getItem('t_url') || '';
        document.getElementById('workerKey').value = localStorage.getItem('t_key') || '';
        setMode('help');

        function toggleSettings() { document.getElementById('settings').classList.toggle('hidden'); }

        function setMode(m) {
            currentMode = m;
            const h = document.getElementById('mode-help');
            const d = document.getElementById('mode-debate');
            if(m === 'help') {
                h.className = "text-xs font-black px-4 py-2 rounded-full bg-blue-600 text-white";
                d.className = "text-xs font-black px-4 py-2 rounded-full bg-slate-800 text-slate-500";
            } else {
                d.className = "text-xs font-black px-4 py-2 rounded-full bg-red-600 text-white";
                h.className = "text-xs font-black px-4 py-2 rounded-full bg-slate-800 text-slate-500";
            }
        }

        async function syncModels() {
            const btn = document.getElementById('syncBtn');
            const url = document.getElementById('workerUrl').value.replace(/\/$/, "") + "/v1/models";
            btn.innerText = "‚è≥ SYNCING...";
            
            try {
                const res = await fetch(url, {
                    headers: { "Authorization": `Bearer ${document.getElementById('workerKey').value}` }
                });
                const json = await res.json();
                const m1 = document.getElementById('model1');
                const m2 = document.getElementById('model2');
                [m1, m2].forEach(s => {
                    s.innerHTML = "";
                    json.data.forEach(m => s.add(new Option(m.id, m.id)));
                });
                btn.innerText = "‚úÖ SYNCED";
            } catch (e) {
                btn.innerText = "‚ùå FAILED";
                alert("CORS or URL Error. Check Console.");
            }
        }

        async function apiCall(model, prompt, sys = "") {
            const url = document.getElementById('workerUrl').value.replace(/\/$/, "") + "/v1/chat/completions";
            const res = await fetch(url, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${document.getElementById('workerKey').value}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{role: "system", content: sys}, {role: "user", content: prompt}]
                })
            });
            const data = await res.json();
            return data.choices[0].message.content;
        }

        async function initiateSequence() {
            const out = document.getElementById('output');
            const prompt = document.getElementById('userInput').value;
            const m1 = document.getElementById('model1').value;
            const m2 = document.getElementById('model2').value;
            
            if(!prompt) return;
            localStorage.setItem('t_url', document.getElementById('workerUrl').value);
            localStorage.setItem('t_key', document.getElementById('workerKey').value);

            out.innerHTML = "<div class='text-center py-10 opacity-30 animate-pulse'>ROUTING NEURAL PATHWAYS...</div>";

            try {
                if(currentMode === 'help') {
                    const r1 = await apiCall(m1, prompt, "Provide a technical solution.");
                    renderCard(m1, r1, "Architect Draft", "border-blue-500 bg-blue-500/5");
                    const r2 = await apiCall(m2, `Review this: ${r1}`, "Critique and refine the logic.");
                    renderCard(m2, r2, "Refined Consensus", "border-green-500 bg-green-500/5");
                } else {
                    const r1 = await apiCall(m1, prompt, "Argue FOR the topic.");
                    renderCard(m1, r1, "Argument: PRO", "border-blue-500 bg-blue-500/5");
                    const r2 = await apiCall(m2, prompt, "Argue AGAINST the topic.");
                    renderCard(m2, r2, "Argument: CON", "border-red-500 bg-red-500/5");
                }
            } catch (e) {
                out.innerHTML = `<div class='p-4 text-red-400 bg-red-900/20 border border-red-500 rounded-2xl'>ERROR: ${e.message}</div>`;
            }
        }

        function renderCard(model, text, label, style) {
            if(document.querySelector('.animate-pulse')) document.getElementById('output').innerHTML = '';
            const div = document.createElement('div');
            div.className = `output-card glass p-6 rounded-3xl border-l-4 ${style}`;
            div.innerHTML = `<div class="text-[9px] font-black opacity-40 mb-2 tracking-[0.2em] uppercase">${label} // ${model}</div><div class="text-sm leading-relaxed whitespace-pre-wrap">${text}</div>`;
            document.getElementById('output').appendChild(div);
        }
    </script>
</body>
</html>
